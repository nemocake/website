<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CMS | con.rad</title>

  <link rel="stylesheet" href="../assets/css/variables.css">

  <style>
    /* ==========================================================================
       CMS ADMIN STYLES
       Simple, clean interface for content management
       ========================================================================== */

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --cms-bg: #f5f5f5;
      --cms-surface: #ffffff;
      --cms-border: #e0e0e0;
      --cms-text: #1a1a1a;
      --cms-text-secondary: #666666;
      --cms-text-muted: #999999;
      --cms-primary: #2563eb;
      --cms-primary-hover: #1d4ed8;
      --cms-danger: #dc2626;
      --cms-success: #16a34a;
      --cms-warning: #f59e0b;
      --cms-radius: 6px;
      --cms-shadow: 0 1px 3px rgba(0,0,0,0.1);
      --cms-shadow-lg: 0 4px 12px rgba(0,0,0,0.1);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      line-height: 1.5;
      color: var(--cms-text);
      background: var(--cms-bg);
      min-height: 100vh;
    }

    /* Layout */
    .cms-layout {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .cms-sidebar {
      width: 240px;
      background: var(--cms-surface);
      border-right: 1px solid var(--cms-border);
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      overflow-y: auto;
      z-index: 100;
    }

    .cms-sidebar__header {
      padding: 20px;
      border-bottom: 1px solid var(--cms-border);
    }

    .cms-sidebar__logo {
      font-size: 18px;
      font-weight: 600;
      color: var(--cms-text);
      text-decoration: none;
      display: block;
    }

    .cms-sidebar__subtitle {
      font-size: 12px;
      color: var(--cms-text-muted);
      margin-top: 4px;
    }

    .cms-nav {
      padding: 12px 0;
    }

    .cms-nav__section {
      padding: 8px 20px 4px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--cms-text-muted);
    }

    .cms-nav__link {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 20px;
      color: var(--cms-text-secondary);
      text-decoration: none;
      transition: all 0.15s ease;
    }

    .cms-nav__link:hover {
      background: var(--cms-bg);
      color: var(--cms-text);
    }

    .cms-nav__link.active {
      background: #eff6ff;
      color: var(--cms-primary);
      font-weight: 500;
    }

    .cms-nav__link svg {
      width: 18px;
      height: 18px;
      opacity: 0.7;
    }

    .cms-nav__divider {
      height: 1px;
      background: var(--cms-border);
      margin: 12px 20px;
    }

    /* Main Content */
    .cms-main {
      flex: 1;
      margin-left: 240px;
      padding: 24px 32px;
      max-width: 900px;
    }

    /* Wider layout for writings editor with preview */
    .cms-editor-layout.with-preview {
      max-width: none;
    }

    .cms-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .cms-header__title {
      font-size: 24px;
      font-weight: 600;
    }

    .cms-header__actions {
      display: flex;
      gap: 8px;
    }

    /* Cards */
    .cms-card {
      background: var(--cms-surface);
      border: 1px solid var(--cms-border);
      border-radius: var(--cms-radius);
      margin-bottom: 20px;
      box-shadow: var(--cms-shadow);
    }

    .cms-card__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid var(--cms-border);
    }

    .cms-card__title {
      font-size: 15px;
      font-weight: 600;
    }

    .cms-card__body {
      padding: 20px;
    }

    .cms-card__footer {
      padding: 12px 20px;
      background: var(--cms-bg);
      border-top: 1px solid var(--cms-border);
      border-radius: 0 0 var(--cms-radius) var(--cms-radius);
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    /* Form Elements */
    .cms-field {
      margin-bottom: 16px;
    }

    .cms-field:last-child {
      margin-bottom: 0;
    }

    .cms-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: var(--cms-text);
      margin-bottom: 6px;
    }

    .cms-label-hint {
      font-weight: 400;
      color: var(--cms-text-muted);
      margin-left: 8px;
    }

    .cms-input,
    .cms-textarea,
    .cms-select {
      width: 100%;
      padding: 8px 12px;
      font-size: 14px;
      font-family: inherit;
      border: 1px solid var(--cms-border);
      border-radius: var(--cms-radius);
      background: var(--cms-surface);
      color: var(--cms-text);
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    .cms-input:focus,
    .cms-textarea:focus,
    .cms-select:focus {
      outline: none;
      border-color: var(--cms-primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .cms-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .cms-textarea--short {
      min-height: 60px;
    }

    .cms-input--url {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
      font-size: 13px;
    }

    /* Buttons */
    .cms-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 500;
      font-family: inherit;
      border-radius: var(--cms-radius);
      border: 1px solid transparent;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .cms-btn svg {
      width: 16px;
      height: 16px;
    }

    .cms-btn--primary {
      background: var(--cms-primary);
      color: white;
    }

    .cms-btn--primary:hover {
      background: var(--cms-primary-hover);
    }

    .cms-btn--secondary {
      background: var(--cms-surface);
      border-color: var(--cms-border);
      color: var(--cms-text);
    }

    .cms-btn--secondary:hover {
      background: var(--cms-bg);
    }

    .cms-btn--danger {
      background: var(--cms-danger);
      color: white;
    }

    .cms-btn--danger:hover {
      background: #b91c1c;
    }

    .cms-btn--small {
      padding: 6px 10px;
      font-size: 12px;
    }

    .cms-btn--icon {
      padding: 6px;
      min-width: 32px;
    }

    /* Item List (for repeatable items like collection) */
    .cms-item-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .cms-item {
      background: var(--cms-bg);
      border: 1px solid var(--cms-border);
      border-radius: var(--cms-radius);
      overflow: hidden;
    }

    .cms-item__header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: var(--cms-surface);
      border-bottom: 1px solid var(--cms-border);
      cursor: pointer;
    }

    .cms-item__header:hover {
      background: var(--cms-bg);
    }

    .cms-item__drag {
      color: var(--cms-text-muted);
      cursor: grab;
    }

    .cms-item__preview {
      width: 48px;
      height: 48px;
      border-radius: 4px;
      object-fit: cover;
      background: var(--cms-border);
    }

    .cms-item__info {
      flex: 1;
      min-width: 0;
    }

    .cms-item__title {
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .cms-item__subtitle {
      font-size: 12px;
      color: var(--cms-text-muted);
    }

    .cms-item__actions {
      display: flex;
      gap: 4px;
    }

    .cms-item__body {
      padding: 16px;
      display: none;
    }

    .cms-item.expanded .cms-item__body {
      display: block;
    }

    .cms-item__expand {
      transition: transform 0.2s ease;
    }

    .cms-item.expanded .cms-item__expand {
      transform: rotate(180deg);
    }

    /* Grid for side-by-side fields */
    .cms-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    .cms-grid--3 {
      grid-template-columns: repeat(3, 1fr);
    }

    /* Status Messages */
    .cms-toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      padding: 12px 20px;
      background: var(--cms-text);
      color: white;
      border-radius: var(--cms-radius);
      box-shadow: var(--cms-shadow-lg);
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }

    .cms-toast--success {
      background: var(--cms-success);
    }

    .cms-toast--error {
      background: var(--cms-danger);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Empty State */
    .cms-empty {
      text-align: center;
      padding: 40px 20px;
      color: var(--cms-text-muted);
    }

    .cms-empty svg {
      width: 48px;
      height: 48px;
      margin-bottom: 12px;
      opacity: 0.5;
    }

    /* Section visibility */
    .cms-section {
      display: none;
    }

    .cms-section.active {
      display: block;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .cms-sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }

      .cms-sidebar.open {
        transform: translateX(0);
      }

      .cms-main {
        margin-left: 0;
        padding: 16px;
      }

      .cms-grid {
        grid-template-columns: 1fr;
      }
    }

    /* JSON Editor */
    .cms-json-editor {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
      font-size: 12px;
      line-height: 1.6;
      min-height: 400px;
      tab-size: 2;
    }

    /* Preview Link */
    .cms-preview-link {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      color: var(--cms-primary);
      text-decoration: none;
    }

    .cms-preview-link:hover {
      text-decoration: underline;
    }

    /* Writings Editor Styles */
    .cms-editor-layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .cms-editor-layout.with-preview {
      grid-template-columns: 1fr 1fr;
    }

    @media (max-width: 1200px) {
      .cms-editor-layout.with-preview {
        grid-template-columns: 1fr;
      }
    }

    .cms-editor-toolbar {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
      padding: 8px;
      background: var(--cms-bg);
      border: 1px solid var(--cms-border);
      border-radius: var(--cms-radius);
      margin-bottom: 8px;
    }

    .cms-toolbar-btn {
      padding: 6px 10px;
      border: 1px solid var(--cms-border);
      border-radius: 4px;
      background: var(--cms-surface);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .cms-toolbar-btn:hover {
      background: var(--cms-bg);
    }

    .cms-toolbar-sep {
      width: 1px;
      background: var(--cms-border);
      margin: 0 4px;
    }

    .cms-content-textarea {
      min-height: 300px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
      font-size: 13px;
      line-height: 1.6;
      resize: vertical;
    }

    .cms-preview-panel {
      background: var(--cms-surface);
      border: 1px solid var(--cms-border);
      border-radius: var(--cms-radius);
      padding: 20px;
      max-height: 600px;
      overflow-y: auto;
    }

    .cms-preview-panel h1 {
      font-size: 1.75rem;
      margin-bottom: 12px;
    }

    .cms-preview-panel .preview-meta {
      color: var(--cms-text-muted);
      font-size: 13px;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--cms-border);
    }

    .cms-preview-panel .preview-content {
      line-height: 1.7;
    }

    .cms-preview-panel .preview-content p {
      margin-bottom: 16px;
    }

    .cms-preview-panel .preview-content h2 {
      font-size: 1.4rem;
      margin: 24px 0 12px;
    }

    .cms-preview-panel .preview-content h3 {
      font-size: 1.2rem;
      margin: 20px 0 8px;
    }

    .cms-preview-panel .preview-content blockquote {
      border-left: 3px solid var(--cms-border);
      padding-left: 16px;
      margin: 16px 0;
      font-style: italic;
      color: var(--cms-text-secondary);
    }

    .cms-preview-panel .preview-content code {
      background: var(--cms-bg);
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 0.9em;
      font-family: ui-monospace, monospace;
    }

    .cms-preview-panel .preview-content ul,
    .cms-preview-panel .preview-content ol {
      margin: 16px 0;
      padding-left: 24px;
    }

    .cms-preview-panel .preview-content li {
      margin-bottom: 8px;
    }

    .cms-writing-form {
      display: none;
    }

    .cms-writing-form.active {
      display: block;
    }

    .cms-autosave-status {
      font-size: 11px;
      color: var(--cms-text-muted);
    }

    .cms-form-actions {
      display: flex;
      gap: 8px;
      padding-top: 16px;
      border-top: 1px solid var(--cms-border);
      margin-top: 16px;
      flex-wrap: wrap;
    }

    .cms-help-text {
      font-size: 11px;
      color: var(--cms-text-muted);
      margin-top: 4px;
    }

    .cms-help-text code {
      background: var(--cms-bg);
      padding: 1px 4px;
      border-radius: 2px;
    }
  </style>
</head>
<body>
  <div class="cms-layout">

    <!-- Sidebar Navigation -->
    <aside class="cms-sidebar">
      <div class="cms-sidebar__header">
        <a href="../" class="cms-sidebar__logo">con.rad</a>
        <div class="cms-sidebar__subtitle">Content Manager</div>
      </div>

      <nav class="cms-nav">
        <div class="cms-nav__section">Content</div>

        <a href="#profile" class="cms-nav__link active" data-section="profile">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
          Profile
        </a>

        <a href="#collection" class="cms-nav__link" data-section="collection">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"/>
            <rect x="14" y="3" width="7" height="7"/>
            <rect x="14" y="14" width="7" height="7"/>
            <rect x="3" y="14" width="7" height="7"/>
          </svg>
          Collection
        </a>

        <a href="#artworks" class="cms-nav__link" data-section="artworks">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2"/>
            <circle cx="8.5" cy="8.5" r="1.5"/>
            <path d="M21 15l-5-5L5 21"/>
          </svg>
          Background Art
        </a>

        <a href="#social" class="cms-nav__link" data-section="social">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
          </svg>
          Social Links
        </a>

        <a href="#inspirations" class="cms-nav__link" data-section="inspirations">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg>
          Inspirations
        </a>

        <a href="#writings" class="cms-nav__link" data-section="writings">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 19l7-7 3 3-7 7-3-3z"/>
            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
            <path d="M2 2l7.586 7.586"/>
            <circle cx="11" cy="11" r="2"/>
          </svg>
          Writings
        </a>

        <div class="cms-nav__divider"></div>
        <div class="cms-nav__section">Advanced</div>

        <a href="#export" class="cms-nav__link" data-section="export">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          Export / Import
        </a>

        <div class="cms-nav__divider"></div>

        <a href="../" class="cms-nav__link">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
          Back to Site
        </a>
      </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="cms-main">

      <!-- Profile Section -->
      <section class="cms-section active" id="section-profile">
        <div class="cms-header">
          <h1 class="cms-header__title">Profile</h1>
          <div class="cms-header__actions">
            <a href="../" target="_blank" class="cms-preview-link">
              <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                <polyline points="15 3 21 3 21 9"/>
                <line x1="10" y1="14" x2="21" y2="3"/>
              </svg>
              Preview Site
            </a>
          </div>
        </div>

        <div class="cms-card">
          <div class="cms-card__header">
            <h2 class="cms-card__title">Basic Information</h2>
          </div>
          <div class="cms-card__body">
            <div class="cms-grid">
              <div class="cms-field">
                <label class="cms-label">Name</label>
                <input type="text" class="cms-input" id="profile-name" placeholder="Your name">
              </div>
              <div class="cms-field">
                <label class="cms-label">Title / Role</label>
                <input type="text" class="cms-input" id="profile-title" placeholder="e.g., Digital Artist">
              </div>
            </div>
            <div class="cms-field">
              <label class="cms-label">Bio</label>
              <textarea class="cms-textarea" id="profile-bio" placeholder="A short bio about yourself..."></textarea>
            </div>
            <div class="cms-field">
              <label class="cms-label">Profile Photo URL</label>
              <input type="url" class="cms-input cms-input--url" id="profile-photo" placeholder="https://...">
            </div>
          </div>
          <div class="cms-card__footer">
            <button class="cms-btn cms-btn--primary" onclick="saveProfile()">Save Changes</button>
          </div>
        </div>
      </section>

      <!-- Collection Section -->
      <section class="cms-section" id="section-collection">
        <div class="cms-header">
          <h1 class="cms-header__title">Collection</h1>
          <div class="cms-header__actions">
            <button class="cms-btn cms-btn--primary" onclick="addCollectionItem()">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
              Add Item
            </button>
          </div>
        </div>

        <div class="cms-card">
          <div class="cms-card__header">
            <h2 class="cms-card__title">Collection Items</h2>
            <span class="cms-text-muted" id="collection-count">0 items</span>
          </div>
          <div class="cms-card__body">
            <div class="cms-item-list" id="collection-list">
              <!-- Items populated by JS -->
            </div>
            <div class="cms-empty" id="collection-empty">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <line x1="12" y1="8" x2="12" y2="16"/>
                <line x1="8" y1="12" x2="16" y2="12"/>
              </svg>
              <p>No collection items yet.<br>Click "Add Item" to create one.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Background Artworks Section -->
      <section class="cms-section" id="section-artworks">
        <div class="cms-header">
          <h1 class="cms-header__title">Background Artworks</h1>
          <div class="cms-header__actions">
            <button class="cms-btn cms-btn--primary" onclick="addArtwork()">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
              Add Artwork
            </button>
          </div>
        </div>

        <div class="cms-card">
          <div class="cms-card__header">
            <h2 class="cms-card__title">Interactive Background Art</h2>
            <span class="cms-text-muted" id="artworks-count">0 artworks</span>
          </div>
          <div class="cms-card__body">
            <p style="margin-bottom: 16px; color: var(--cms-text-secondary); font-size: 13px;">
              These artworks are randomly displayed as the fullscreen background on your homepage.
            </p>
            <div class="cms-item-list" id="artworks-list">
              <!-- Items populated by JS -->
            </div>
            <div class="cms-empty" id="artworks-empty">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <path d="M21 15l-5-5L5 21"/>
              </svg>
              <p>No background artworks yet.<br>Click "Add Artwork" to create one.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Social Links Section -->
      <section class="cms-section" id="section-social">
        <div class="cms-header">
          <h1 class="cms-header__title">Social Links</h1>
        </div>

        <div class="cms-card">
          <div class="cms-card__header">
            <h2 class="cms-card__title">Social Media</h2>
          </div>
          <div class="cms-card__body">
            <div class="cms-grid">
              <div class="cms-field">
                <label class="cms-label">Twitter / X</label>
                <input type="url" class="cms-input cms-input--url" id="social-twitter" placeholder="https://twitter.com/...">
              </div>
              <div class="cms-field">
                <label class="cms-label">Instagram</label>
                <input type="url" class="cms-input cms-input--url" id="social-instagram" placeholder="https://instagram.com/...">
              </div>
              <div class="cms-field">
                <label class="cms-label">GitHub</label>
                <input type="url" class="cms-input cms-input--url" id="social-github" placeholder="https://github.com/...">
              </div>
              <div class="cms-field">
                <label class="cms-label">LinkedIn</label>
                <input type="url" class="cms-input cms-input--url" id="social-linkedin" placeholder="https://linkedin.com/in/...">
              </div>
              <div class="cms-field">
                <label class="cms-label">Are.na</label>
                <input type="url" class="cms-input cms-input--url" id="social-arena" placeholder="https://are.na/...">
              </div>
              <div class="cms-field">
                <label class="cms-label">Email</label>
                <input type="email" class="cms-input" id="social-email" placeholder="your@email.com">
              </div>
            </div>
          </div>
          <div class="cms-card__footer">
            <button class="cms-btn cms-btn--primary" onclick="saveSocial()">Save Changes</button>
          </div>
        </div>
      </section>

      <!-- Inspirations Section -->
      <section class="cms-section" id="section-inspirations">
        <div class="cms-header">
          <h1 class="cms-header__title">Inspirations</h1>
        </div>

        <div class="cms-card">
          <div class="cms-card__header">
            <h2 class="cms-card__title">Are.na Integration</h2>
          </div>
          <div class="cms-card__body">
            <div class="cms-grid">
              <div class="cms-field">
                <label class="cms-label">Channel Slug</label>
                <input type="text" class="cms-input" id="inspirations-channel" placeholder="e.g., visually-intriguing">
              </div>
              <div class="cms-field">
                <label class="cms-label">Items to Display</label>
                <input type="number" class="cms-input" id="inspirations-count" placeholder="12" min="1" max="50">
              </div>
            </div>
            <div class="cms-field">
              <label class="cms-label">Channel URL <span class="cms-label-hint">(for "View All" link)</span></label>
              <input type="url" class="cms-input cms-input--url" id="inspirations-url" placeholder="https://www.are.na/username/channel-name">
            </div>
          </div>
          <div class="cms-card__footer">
            <button class="cms-btn cms-btn--primary" onclick="saveInspirations()">Save Changes</button>
          </div>
        </div>
      </section>

      <!-- Writings Section -->
      <section class="cms-section" id="section-writings">
        <div class="cms-header">
          <h1 class="cms-header__title">Writings</h1>
          <div class="cms-header__actions">
            <button class="cms-btn cms-btn--primary" onclick="showWritingEditor()">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
              New Writing
            </button>
          </div>
        </div>

        <!-- Writings List -->
        <div class="cms-card" id="writings-list-card">
          <div class="cms-card__header">
            <h2 class="cms-card__title">Published Writings</h2>
            <span class="cms-text-muted" id="writings-count">0 writings</span>
          </div>
          <div class="cms-card__body">
            <p style="margin-bottom: 16px; color: var(--cms-text-secondary); font-size: 13px;">
              Writings are displayed on the homepage and the Writings page. Changes sync automatically.
            </p>
            <div class="cms-item-list" id="writings-list">
              <!-- Items populated by JS -->
            </div>
            <div class="cms-empty" id="writings-empty">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M12 19l7-7 3 3-7 7-3-3z"/>
                <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
              </svg>
              <p>No writings yet.<br>Click "New Writing" to create one.</p>
            </div>
          </div>
        </div>

        <!-- Writing Editor Form -->
        <div class="cms-card cms-writing-form" id="writing-editor">
          <div class="cms-card__header">
            <h2 class="cms-card__title" id="writing-editor-title">New Writing</h2>
            <div style="display: flex; align-items: center; gap: 12px;">
              <span class="cms-autosave-status" id="writing-autosave-status"></span>
              <button class="cms-btn cms-btn--small cms-btn--secondary" onclick="hideWritingEditor()">Cancel</button>
            </div>
          </div>
          <div class="cms-card__body">
            <div class="cms-editor-layout" id="writing-editor-layout">
              <!-- Editor Panel -->
              <div class="cms-editor-panel">
                <input type="hidden" id="writing-edit-index" value="-1">

                <div class="cms-field">
                  <label class="cms-label">Title</label>
                  <input type="text" class="cms-input" id="writing-title" placeholder="Enter title..." style="font-size: 18px; font-weight: 500; padding: 12px;">
                </div>

                <div class="cms-grid">
                  <div class="cms-field">
                    <label class="cms-label">Date</label>
                    <input type="date" class="cms-input" id="writing-date">
                  </div>
                  <div class="cms-field">
                    <label class="cms-label">Pull Quote <span class="cms-label-hint">(optional highlight)</span></label>
                    <input type="text" class="cms-input" id="writing-quote" placeholder="A memorable quote from your writing...">
                  </div>
                </div>

                <div class="cms-field">
                  <label class="cms-label">Description <span class="cms-label-hint">(shown in previews)</span></label>
                  <input type="text" class="cms-input" id="writing-description" placeholder="A brief summary...">
                </div>

                <!-- Markdown Toolbar -->
                <div class="cms-editor-toolbar">
                  <button type="button" class="cms-toolbar-btn" data-action="bold" title="Bold"><strong>B</strong></button>
                  <button type="button" class="cms-toolbar-btn" data-action="italic" title="Italic"><em>I</em></button>
                  <button type="button" class="cms-toolbar-btn" data-action="link" title="Link">Link</button>
                  <span class="cms-toolbar-sep"></span>
                  <button type="button" class="cms-toolbar-btn" data-action="h2" title="Heading 2">H2</button>
                  <button type="button" class="cms-toolbar-btn" data-action="h3" title="Heading 3">H3</button>
                  <span class="cms-toolbar-sep"></span>
                  <button type="button" class="cms-toolbar-btn" data-action="ul" title="Bullet List">List</button>
                  <button type="button" class="cms-toolbar-btn" data-action="quote" title="Quote">Quote</button>
                  <button type="button" class="cms-toolbar-btn" data-action="code" title="Code">Code</button>
                  <span class="cms-toolbar-sep"></span>
                  <button type="button" class="cms-toolbar-btn" data-action="hr" title="Divider">---</button>
                </div>

                <div class="cms-field">
                  <label class="cms-label">Content <span class="cms-label-hint">(Markdown supported)</span></label>
                  <textarea class="cms-textarea cms-content-textarea" id="writing-content" placeholder="Write your content here...

Supports Markdown:
- **bold** or __bold__
- *italic* or _italic_
- [link text](url)
- ## Heading 2
- ### Heading 3
- - bullet list
- > blockquote
- `inline code`"></textarea>
                  <p class="cms-help-text">
                    Markdown: <code>**bold**</code> <code>*italic*</code> <code>[link](url)</code> <code>## heading</code> <code>> quote</code>
                  </p>
                </div>

                <div class="cms-form-actions">
                  <button class="cms-btn cms-btn--primary" onclick="saveWriting()">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                      <polyline points="17 21 17 13 7 13 7 21"/>
                      <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Save Writing
                  </button>
                  <button class="cms-btn cms-btn--secondary" onclick="toggleWritingPreview()">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                      <circle cx="12" cy="12" r="3"/>
                    </svg>
                    <span id="preview-btn-text">Show Preview</span>
                  </button>
                  <button class="cms-btn cms-btn--secondary" onclick="hideWritingEditor()">Cancel</button>
                </div>
              </div>

              <!-- Preview Panel -->
              <div class="cms-preview-panel" id="writing-preview" style="display: none;">
                <h1 id="preview-title">Title</h1>
                <div class="preview-meta">
                  <span id="preview-date">January 1, 2026</span>
                </div>
                <div class="preview-content" id="preview-content">
                  <p>Start writing to see a preview...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Export/Import Section -->
      <section class="cms-section" id="section-export">
        <div class="cms-header">
          <h1 class="cms-header__title">Export / Import</h1>
        </div>

        <div class="cms-card">
          <div class="cms-card__header">
            <h2 class="cms-card__title">Site Configuration</h2>
          </div>
          <div class="cms-card__body">
            <div style="background: #e8f4fd; border: 1px solid #b8daff; border-radius: var(--cms-radius); padding: 16px; margin-bottom: 20px;">
              <strong style="color: #004085;">How it works:</strong>
              <p style="color: #004085; font-size: 13px; margin: 8px 0 0 0;">
                Your site now reads configuration from <code style="background: rgba(0,0,0,0.1); padding: 2px 6px; border-radius: 3px;">/data/config.json</code>.
                Download the updated config below and save it to that file to update your site.
              </p>
            </div>

            <div class="cms-field">
              <label class="cms-label">Configuration Preview</label>
              <textarea class="cms-textarea cms-json-editor" id="json-editor" placeholder="Configuration JSON will appear here..."></textarea>
            </div>
          </div>
          <div class="cms-card__footer">
            <button class="cms-btn cms-btn--secondary" onclick="loadFromConfigJson()">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 15v4c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-4M17 9l-5 5-5-5M12 12.8V2.5"/>
              </svg>
              Load from config.json
            </button>
            <button class="cms-btn cms-btn--secondary" onclick="copyJson()">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2"/>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
              </svg>
              Copy
            </button>
            <button class="cms-btn cms-btn--primary" onclick="downloadConfigJson()">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              Download config.json
            </button>
          </div>
        </div>

        <div class="cms-card">
          <div class="cms-card__header">
            <h2 class="cms-card__title">Apply Changes to Site</h2>
          </div>
          <div class="cms-card__body">
            <ol style="color: var(--cms-text-secondary); font-size: 13px; padding-left: 20px; line-height: 1.8;">
              <li>Click <strong>"Download config.json"</strong> above to get your updated configuration</li>
              <li>Save/replace the file at <code style="background: var(--cms-bg); padding: 2px 6px; border-radius: 3px;">your-site/data/config.json</code></li>
              <li>Refresh your website to see the changes</li>
            </ol>
            <p style="color: var(--cms-text-muted); font-size: 12px; margin-top: 12px;">
              Changes are also stored in your browser's localStorage and will persist locally until you clear browser data.
            </p>
          </div>
        </div>

        <div class="cms-card">
          <div class="cms-card__header">
            <h2 class="cms-card__title">Import from File</h2>
          </div>
          <div class="cms-card__body">
            <p style="color: var(--cms-text-secondary); font-size: 13px; margin-bottom: 12px;">
              Upload a previously exported config.json or paste JSON directly into the editor above and click Import.
            </p>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              <input type="file" id="config-file-input" accept=".json" style="display: none;" onchange="handleFileImport(event)">
              <button class="cms-btn cms-btn--secondary" onclick="document.getElementById('config-file-input').click()">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="17 8 12 3 7 8"/>
                  <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                Upload File
              </button>
              <button class="cms-btn cms-btn--secondary" onclick="importJson()">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="16 16 12 12 8 16"/>
                  <line x1="12" y1="12" x2="12" y2="21"/>
                  <path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/>
                </svg>
                Import from Editor
              </button>
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <script>
    // ==========================================================================
    // CMS CONTROLLER
    // ==========================================================================

    // Default config structure - MUST match /data/config.json order exactly
    const DEFAULT_CONFIG = {
      backgroundArt: {
        src: '',
        title: '',
        artist: '',
        year: ''
      },
      artworks: [],
      collection: [],
      writings: [],
      inspirations: {
        channel: '',
        channelUrl: '',
        itemCount: 12
      },
      profile: {
        name: '',
        title: '',
        bio: '',
        photo: ''
      },
      social: {
        twitter: '',
        instagram: '',
        github: '',
        linkedin: '',
        arena: '',
        email: ''
      }
    };

    // Key order for export - matches /data/config.json exactly
    const CONFIG_KEY_ORDER = [
      'backgroundArt',
      'artworks',
      'collection',
      'writings',
      'inspirations',
      'profile',
      'social'
    ];

    // Current config state
    let config = JSON.parse(JSON.stringify(DEFAULT_CONFIG));

    // ==========================================================================
    // INITIALIZATION
    // ==========================================================================

    function init() {
      loadConfig();
      setupNavigation();
      renderAll();
      updateJsonEditor();
    }

    function loadConfig() {
      // Try localStorage first
      const stored = localStorage.getItem('conradCMSConfig');
      if (stored) {
        try {
          const parsed = JSON.parse(stored);
          config = { ...DEFAULT_CONFIG, ...parsed };
        } catch (e) {
          console.warn('Failed to parse stored config');
        }
      }

      // Also try to load collection from the main site's localStorage
      const collection = localStorage.getItem('conradCollection');
      if (collection && !config.collection.length) {
        try {
          config.collection = JSON.parse(collection);
        } catch (e) {}
      }

      // Also try to load writings from the main site's localStorage
      const writings = localStorage.getItem('conradWritings');
      if (writings && (!config.writings || !config.writings.length)) {
        try {
          config.writings = JSON.parse(writings);
        } catch (e) {}
      }
    }

    function saveConfig() {
      localStorage.setItem('conradCMSConfig', JSON.stringify(config));
      // Also update the collection storage for the gallery page
      localStorage.setItem('conradCollection', JSON.stringify(config.collection));
      // Also update writings storage for homepage and writings page
      localStorage.setItem('conradWritings', JSON.stringify(config.writings || []));
      updateJsonEditor();
    }

    // ==========================================================================
    // NAVIGATION
    // ==========================================================================

    function setupNavigation() {
      const links = document.querySelectorAll('.cms-nav__link[data-section]');
      links.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const section = link.dataset.section;
          showSection(section);

          // Update active state
          links.forEach(l => l.classList.remove('active'));
          link.classList.add('active');

          // Update hash
          history.pushState(null, '', `#${section}`);
        });
      });

      // Handle initial hash
      const hash = window.location.hash.slice(1);
      if (hash) {
        showSection(hash);
        const activeLink = document.querySelector(`.cms-nav__link[data-section="${hash}"]`);
        if (activeLink) {
          document.querySelectorAll('.cms-nav__link').forEach(l => l.classList.remove('active'));
          activeLink.classList.add('active');
        }
      }
    }

    function showSection(sectionId) {
      document.querySelectorAll('.cms-section').forEach(s => s.classList.remove('active'));
      const section = document.getElementById(`section-${sectionId}`);
      if (section) section.classList.add('active');
    }

    // ==========================================================================
    // RENDER FUNCTIONS
    // ==========================================================================

    function renderAll() {
      renderProfile();
      renderSocial();
      renderCollection();
      renderArtworks();
      renderInspirations();
      renderWritings();
    }

    function renderProfile() {
      document.getElementById('profile-name').value = config.profile?.name || '';
      document.getElementById('profile-title').value = config.profile?.title || '';
      document.getElementById('profile-bio').value = config.profile?.bio || '';
      document.getElementById('profile-photo').value = config.profile?.photo || '';
    }

    function renderSocial() {
      document.getElementById('social-twitter').value = config.social?.twitter || '';
      document.getElementById('social-instagram').value = config.social?.instagram || '';
      document.getElementById('social-github').value = config.social?.github || '';
      document.getElementById('social-linkedin').value = config.social?.linkedin || '';
      document.getElementById('social-arena').value = config.social?.arena || '';
      document.getElementById('social-email').value = config.social?.email || '';
    }

    function renderInspirations() {
      document.getElementById('inspirations-channel').value = config.inspirations?.channel || '';
      document.getElementById('inspirations-url').value = config.inspirations?.channelUrl || '';
      document.getElementById('inspirations-count').value = config.inspirations?.itemCount || 12;
    }

    function renderCollection() {
      const list = document.getElementById('collection-list');
      const empty = document.getElementById('collection-empty');
      const count = document.getElementById('collection-count');

      if (!config.collection || config.collection.length === 0) {
        list.innerHTML = '';
        empty.style.display = 'block';
        count.textContent = '0 items';
        return;
      }

      empty.style.display = 'none';
      count.textContent = `${config.collection.length} item${config.collection.length !== 1 ? 's' : ''}`;

      list.innerHTML = config.collection.map((item, index) => `
        <div class="cms-item" data-index="${index}">
          <div class="cms-item__header" onclick="toggleItem(this)">
            <span class="cms-item__drag">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="8" y1="6" x2="16" y2="6"/>
                <line x1="8" y1="12" x2="16" y2="12"/>
                <line x1="8" y1="18" x2="16" y2="18"/>
              </svg>
            </span>
            <img class="cms-item__preview" src="${item.thumbnail}" alt="" onerror="this.style.display='none'">
            <div class="cms-item__info">
              <div class="cms-item__title">${item.title || 'Untitled'}</div>
              <div class="cms-item__subtitle">${item.artist || 'No artist'}</div>
            </div>
            <div class="cms-item__actions">
              <button class="cms-btn cms-btn--icon cms-btn--secondary cms-item__expand" title="Expand">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="cms-item__body">
            <div class="cms-grid">
              <div class="cms-field">
                <label class="cms-label">Title</label>
                <input type="text" class="cms-input" value="${escapeHtml(item.title || '')}" onchange="updateCollectionItem(${index}, 'title', this.value)">
              </div>
              <div class="cms-field">
                <label class="cms-label">Artist</label>
                <input type="text" class="cms-input" value="${escapeHtml(item.artist || '')}" onchange="updateCollectionItem(${index}, 'artist', this.value)">
              </div>
            </div>
            <div class="cms-field">
              <label class="cms-label">Thumbnail URL <span class="cms-label-hint">(used for homepage grid)</span></label>
              <input type="url" class="cms-input cms-input--url" value="${escapeHtml(item.thumbnail || '')}" onchange="updateCollectionItem(${index}, 'thumbnail', this.value)">
            </div>
            <div class="cms-field">
              <label class="cms-label">Render URL <span class="cms-label-hint">(used for collection page display)</span></label>
              <input type="url" class="cms-input cms-input--url" value="${escapeHtml(item.render || '')}" onchange="updateCollectionItem(${index}, 'render', this.value)">
            </div>
            <div class="cms-field">
              <label class="cms-label">Medium</label>
              <input type="text" class="cms-input" value="${escapeHtml(item.medium || '')}" placeholder="e.g., Digital Art, Oil on Canvas" onchange="updateCollectionItem(${index}, 'medium', this.value)">
            </div>
            <div class="cms-field">
              <label class="cms-label">Description <span class="cms-label-hint">(displayed on artwork page sidebar)</span></label>
              <textarea class="cms-textarea cms-textarea--short" placeholder="Write about this piece..." onchange="updateCollectionItem(${index}, 'description', this.value)">${escapeHtml(item.description || '')}</textarea>
            </div>
            <div class="cms-grid" style="margin-top: 12px;">
              <div class="cms-field">
                <label class="cms-label">Media Type</label>
                <select class="cms-input" onchange="updateCollectionItem(${index}, 'type', this.value)">
                  <option value="image" ${(item.type || 'image') === 'image' ? 'selected' : ''}>Image</option>
                  <option value="video" ${item.type === 'video' ? 'selected' : ''}>Video</option>
                  <option value="iframe" ${item.type === 'iframe' ? 'selected' : ''}>Interactive (iframe)</option>
                </select>
              </div>
              <div class="cms-field">
                <label class="cms-label">Aspect Ratio <span class="cms-label-hint">(for video/iframe)</span></label>
                <input type="text" class="cms-input" value="${escapeHtml(item.aspectRatio || '')}" placeholder="e.g., 16 / 9" onchange="updateCollectionItem(${index}, 'aspectRatio', this.value)">
              </div>
            </div>
            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--cms-border);">
              <button class="cms-btn cms-btn--danger cms-btn--small" onclick="deleteCollectionItem(${index})">
                <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"/>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
                Delete Item
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderArtworks() {
      const list = document.getElementById('artworks-list');
      const empty = document.getElementById('artworks-empty');
      const count = document.getElementById('artworks-count');

      if (!config.artworks || config.artworks.length === 0) {
        list.innerHTML = '';
        empty.style.display = 'block';
        count.textContent = '0 artworks';
        return;
      }

      empty.style.display = 'none';
      count.textContent = `${config.artworks.length} artwork${config.artworks.length !== 1 ? 's' : ''}`;

      list.innerHTML = config.artworks.map((item, index) => `
        <div class="cms-item" data-index="${index}">
          <div class="cms-item__header" onclick="toggleItem(this)">
            <span class="cms-item__drag">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="8" y1="6" x2="16" y2="6"/>
                <line x1="8" y1="12" x2="16" y2="12"/>
                <line x1="8" y1="18" x2="16" y2="18"/>
              </svg>
            </span>
            <div class="cms-item__info">
              <div class="cms-item__title">${item.title || 'Untitled Artwork'}</div>
              <div class="cms-item__subtitle" style="font-family: monospace; font-size: 11px;">${truncateUrl(item.url)}</div>
            </div>
            <div class="cms-item__actions">
              <button class="cms-btn cms-btn--icon cms-btn--secondary cms-item__expand" title="Expand">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="cms-item__body">
            <div class="cms-field">
              <label class="cms-label">Title</label>
              <input type="text" class="cms-input" value="${escapeHtml(item.title || '')}" onchange="updateArtwork(${index}, 'title', this.value)">
            </div>
            <div class="cms-field">
              <label class="cms-label">URL <span class="cms-label-hint">(interactive HTML/iframe)</span></label>
              <input type="url" class="cms-input cms-input--url" value="${escapeHtml(item.url || '')}" onchange="updateArtwork(${index}, 'url', this.value)">
            </div>
            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--cms-border);">
              <button class="cms-btn cms-btn--danger cms-btn--small" onclick="deleteArtwork(${index})">
                <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"/>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
                Delete Artwork
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderWritings() {
      const list = document.getElementById('writings-list');
      const empty = document.getElementById('writings-empty');
      const count = document.getElementById('writings-count');

      if (!config.writings || config.writings.length === 0) {
        list.innerHTML = '';
        empty.style.display = 'block';
        count.textContent = '0 writings';
        return;
      }

      empty.style.display = 'none';
      count.textContent = `${config.writings.length} writing${config.writings.length !== 1 ? 's' : ''}`;

      list.innerHTML = config.writings.map((item, index) => `
        <div class="cms-item" data-index="${index}">
          <div class="cms-item__header" onclick="editWriting(${index})">
            <span class="cms-item__drag">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 19l7-7 3 3-7 7-3-3z"/>
                <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
              </svg>
            </span>
            <div class="cms-item__info">
              <div class="cms-item__title">${escapeHtml(item.title || 'Untitled')}</div>
              <div class="cms-item__subtitle">${item.date ? formatDateDisplay(item.date) : 'No date'} &middot; ${escapeHtml(item.description || '').substring(0, 50)}${(item.description || '').length > 50 ? '...' : ''}</div>
            </div>
            <div class="cms-item__actions" onclick="event.stopPropagation();">
              <button class="cms-btn cms-btn--icon cms-btn--secondary" title="Edit" onclick="editWriting(${index})">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                </svg>
              </button>
              <button class="cms-btn cms-btn--icon cms-btn--danger" title="Delete" onclick="deleteWriting(${index})">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"/>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // ==========================================================================
    // WRITINGS FUNCTIONS
    // ==========================================================================

    function generateWritingId(title) {
      return title.toLowerCase()
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-|-$/g, '')
        .substring(0, 50) || 'untitled-' + Date.now();
    }

    function formatDateDisplay(dateStr) {
      if (!dateStr) return 'No date';
      const date = new Date(dateStr + 'T00:00:00');
      return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    }

    function parseMarkdownToHtml(text) {
      if (!text) return '';
      return text
        .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
        .replace(/```(\w*)\n?([\s\S]*?)```/g, '<pre><code>$2</code></pre>')
        .replace(/`([^`]+)`/g, '<code>$1</code>')
        .replace(/^### (.+)$/gm, '<h3>$1</h3>')
        .replace(/^## (.+)$/gm, '<h2>$1</h2>')
        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
        .replace(/__(.+?)__/g, '<strong>$1</strong>')
        .replace(/\*(.+?)\*/g, '<em>$1</em>')
        .replace(/_(.+?)_/g, '<em>$1</em>')
        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>')
        .replace(/^&gt; (.+)$/gm, '<blockquote>$1</blockquote>')
        .replace(/^---$/gm, '<hr>')
        .replace(/^- (.+)$/gm, '<li>$1</li>')
        .split('\n\n')
        .map(function(block) {
          block = block.trim();
          if (!block) return '';
          if (block.startsWith('<h') || block.startsWith('<pre') || block.startsWith('<blockquote') || block.startsWith('<hr') || block.startsWith('<li')) {
            return block.includes('<li>') ? '<ul>' + block + '</ul>' : block;
          }
          return '<p>' + block.replace(/\n/g, '<br>') + '</p>';
        })
        .join('\n')
        .replace(/<\/blockquote>\n<blockquote>/g, '<br>');
    }

    function showWritingEditor(editIndex = -1) {
      document.getElementById('writing-edit-index').value = editIndex;
      document.getElementById('writing-editor-title').textContent = editIndex >= 0 ? 'Edit Writing' : 'New Writing';

      // Clear or populate fields
      if (editIndex >= 0 && config.writings[editIndex]) {
        const writing = config.writings[editIndex];
        document.getElementById('writing-title').value = writing.title || '';
        document.getElementById('writing-date').value = writing.date || '';
        document.getElementById('writing-description').value = writing.description || '';
        document.getElementById('writing-quote').value = writing.quote || '';
        // Convert body array back to markdown text
        const content = Array.isArray(writing.body) ? writing.body.join('\n\n') : (writing.body || '');
        document.getElementById('writing-content').value = content;
      } else {
        document.getElementById('writing-title').value = '';
        document.getElementById('writing-date').value = new Date().toISOString().split('T')[0];
        document.getElementById('writing-description').value = '';
        document.getElementById('writing-quote').value = '';
        document.getElementById('writing-content').value = '';
      }

      // Show editor, hide list
      document.getElementById('writing-editor').classList.add('active');
      document.getElementById('writings-list-card').style.display = 'none';

      // Setup toolbar
      setupWritingToolbar();

      // Update preview if visible
      updateWritingPreview();
    }

    function hideWritingEditor() {
      document.getElementById('writing-editor').classList.remove('active');
      document.getElementById('writings-list-card').style.display = 'block';
      // Hide preview and reset layout
      document.getElementById('writing-preview').style.display = 'none';
      document.getElementById('writing-editor-layout').classList.remove('with-preview');
      document.getElementById('preview-btn-text').textContent = 'Show Preview';
    }

    function editWriting(index) {
      showWritingEditor(index);
    }

    function saveWriting() {
      const editIndex = parseInt(document.getElementById('writing-edit-index').value);
      const title = document.getElementById('writing-title').value.trim();
      const date = document.getElementById('writing-date').value;
      const description = document.getElementById('writing-description').value.trim();
      const quote = document.getElementById('writing-quote').value.trim();
      const content = document.getElementById('writing-content').value.trim();

      if (!title) {
        showToast('Please enter a title', 'error');
        return;
      }

      // Convert content to array of paragraphs for storage (matching the existing format)
      const bodyArray = content.split('\n\n').map(p => p.trim()).filter(Boolean);

      const writing = {
        id: editIndex >= 0 && config.writings[editIndex] ? config.writings[editIndex].id : generateWritingId(title),
        title: title,
        description: description,
        date: date,
        body: bodyArray,
        quote: quote || undefined
      };

      // Remove undefined quote
      if (!writing.quote) delete writing.quote;

      if (!config.writings) config.writings = [];

      if (editIndex >= 0) {
        config.writings[editIndex] = writing;
      } else {
        config.writings.unshift(writing);
      }

      saveConfig();
      renderWritings();
      hideWritingEditor();
      showToast(editIndex >= 0 ? 'Writing updated!' : 'Writing created!', 'success');
    }

    function deleteWriting(index) {
      if (confirm('Delete this writing? This cannot be undone.')) {
        config.writings.splice(index, 1);
        saveConfig();
        renderWritings();
        showToast('Writing deleted', 'success');
      }
    }

    function toggleWritingPreview() {
      const preview = document.getElementById('writing-preview');
      const layout = document.getElementById('writing-editor-layout');
      const btnText = document.getElementById('preview-btn-text');

      if (preview.style.display === 'none') {
        preview.style.display = 'block';
        layout.classList.add('with-preview');
        btnText.textContent = 'Hide Preview';
        updateWritingPreview();
      } else {
        preview.style.display = 'none';
        layout.classList.remove('with-preview');
        btnText.textContent = 'Show Preview';
      }
    }

    function updateWritingPreview() {
      const title = document.getElementById('writing-title').value || 'Title';
      const date = document.getElementById('writing-date').value;
      const content = document.getElementById('writing-content').value;

      document.getElementById('preview-title').textContent = title;
      document.getElementById('preview-date').textContent = date ? formatDateDisplay(date) : 'No date';
      document.getElementById('preview-content').innerHTML = parseMarkdownToHtml(content) || '<p>Start writing to see a preview...</p>';
    }

    function setupWritingToolbar() {
      const contentTextarea = document.getElementById('writing-content');

      // Setup toolbar buttons
      document.querySelectorAll('.cms-toolbar-btn').forEach(btn => {
        btn.onclick = function(e) {
          e.preventDefault();
          const action = btn.getAttribute('data-action');
          insertMarkdown(contentTextarea, action);
          updateWritingPreview();
        };
      });

      // Live preview update on content change
      contentTextarea.addEventListener('input', function() {
        updateWritingPreview();
        autosaveWriting();
      });

      // Also update preview on other field changes
      ['writing-title', 'writing-date'].forEach(id => {
        document.getElementById(id).addEventListener('input', updateWritingPreview);
      });
    }

    function insertMarkdown(textarea, action) {
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const selected = textarea.value.substring(start, end);
      let before = '', after = '';

      switch (action) {
        case 'bold': before = '**'; after = '**'; break;
        case 'italic': before = '*'; after = '*'; break;
        case 'link': before = '['; after = '](url)'; break;
        case 'h2': before = '\n## '; after = '\n'; break;
        case 'h3': before = '\n### '; after = '\n'; break;
        case 'ul': before = '\n- '; after = '\n'; break;
        case 'quote': before = '\n> '; after = '\n'; break;
        case 'code': before = '`'; after = '`'; break;
        case 'hr': before = '\n---\n'; after = ''; break;
      }

      textarea.value = textarea.value.substring(0, start) + before + selected + after + textarea.value.substring(end);
      textarea.focus();
      textarea.setSelectionRange(start + before.length + selected.length, start + before.length + selected.length);
    }

    let writingAutosaveTimer;
    function autosaveWriting() {
      clearTimeout(writingAutosaveTimer);
      writingAutosaveTimer = setTimeout(() => {
        const title = document.getElementById('writing-title').value;
        const content = document.getElementById('writing-content').value;
        if (title || content) {
          localStorage.setItem('cms_writing_autosave', JSON.stringify({
            title: title,
            date: document.getElementById('writing-date').value,
            description: document.getElementById('writing-description').value,
            quote: document.getElementById('writing-quote').value,
            content: content
          }));
          document.getElementById('writing-autosave-status').textContent = 'Auto-saved';
          setTimeout(() => {
            document.getElementById('writing-autosave-status').textContent = '';
          }, 2000);
        }
      }, 2000);
    }

    // ==========================================================================
    // SAVE FUNCTIONS
    // ==========================================================================

    function saveProfile() {
      config.profile = {
        name: document.getElementById('profile-name').value,
        title: document.getElementById('profile-title').value,
        bio: document.getElementById('profile-bio').value,
        photo: document.getElementById('profile-photo').value
      };
      saveConfig();
      showToast('Profile saved!', 'success');
    }

    function saveSocial() {
      config.social = {
        twitter: document.getElementById('social-twitter').value,
        instagram: document.getElementById('social-instagram').value,
        github: document.getElementById('social-github').value,
        linkedin: document.getElementById('social-linkedin').value,
        arena: document.getElementById('social-arena').value,
        email: document.getElementById('social-email').value
      };
      saveConfig();
      showToast('Social links saved!', 'success');
    }

    function saveInspirations() {
      config.inspirations = {
        channel: document.getElementById('inspirations-channel').value,
        channelUrl: document.getElementById('inspirations-url').value,
        itemCount: parseInt(document.getElementById('inspirations-count').value) || 12
      };
      saveConfig();
      showToast('Inspirations saved!', 'success');
    }

    // ==========================================================================
    // COLLECTION FUNCTIONS
    // ==========================================================================

    function addCollectionItem() {
      if (!config.collection) config.collection = [];
      config.collection.push({
        thumbnail: '',
        render: '',
        title: 'New Item',
        artist: '',
        medium: 'Digital Art',
        type: 'image',
        description: ''
      });
      saveConfig();
      renderCollection();

      // Expand the new item
      const items = document.querySelectorAll('#collection-list .cms-item');
      const lastItem = items[items.length - 1];
      if (lastItem) {
        lastItem.classList.add('expanded');
        lastItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }

      showToast('Item added!', 'success');
    }

    function updateCollectionItem(index, field, value) {
      if (config.collection[index]) {
        config.collection[index][field] = value;
        saveConfig();
        // Update preview if image changed
        if (field === 'image' || field === 'title' || field === 'artist') {
          renderCollection();
          // Re-expand the item
          const item = document.querySelector(`#collection-list .cms-item[data-index="${index}"]`);
          if (item) item.classList.add('expanded');
        }
      }
    }

    function deleteCollectionItem(index) {
      if (confirm('Delete this item?')) {
        config.collection.splice(index, 1);
        saveConfig();
        renderCollection();
        showToast('Item deleted', 'success');
      }
    }

    // ==========================================================================
    // ARTWORKS FUNCTIONS
    // ==========================================================================

    function addArtwork() {
      if (!config.artworks) config.artworks = [];
      config.artworks.push({
        title: 'New Artwork',
        url: ''
      });
      saveConfig();
      renderArtworks();

      const items = document.querySelectorAll('#artworks-list .cms-item');
      const lastItem = items[items.length - 1];
      if (lastItem) {
        lastItem.classList.add('expanded');
        lastItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }

      showToast('Artwork added!', 'success');
    }

    function updateArtwork(index, field, value) {
      if (config.artworks[index]) {
        config.artworks[index][field] = value;
        saveConfig();
        if (field === 'title' || field === 'url') {
          renderArtworks();
          const item = document.querySelector(`#artworks-list .cms-item[data-index="${index}"]`);
          if (item) item.classList.add('expanded');
        }
      }
    }

    function deleteArtwork(index) {
      if (confirm('Delete this artwork?')) {
        config.artworks.splice(index, 1);
        saveConfig();
        renderArtworks();
        showToast('Artwork deleted', 'success');
      }
    }

    // ==========================================================================
    // EXPORT / IMPORT
    // ==========================================================================

    function updateJsonEditor() {
      const editor = document.getElementById('json-editor');
      editor.value = formatConfigJson(config);
    }

    // Format config with correct key order matching /data/config.json
    function formatConfigJson(configObj) {
      const ordered = {};

      // Add keys in the correct order
      CONFIG_KEY_ORDER.forEach(key => {
        if (key in configObj) {
          ordered[key] = configObj[key];
        } else if (key in DEFAULT_CONFIG) {
          // Include default value if missing
          ordered[key] = DEFAULT_CONFIG[key];
        }
      });

      // Add any extra keys that might exist (at the end)
      Object.keys(configObj).forEach(key => {
        if (!CONFIG_KEY_ORDER.includes(key)) {
          ordered[key] = configObj[key];
        }
      });

      return JSON.stringify(ordered, null, 2);
    }

    function copyJson() {
      const editor = document.getElementById('json-editor');
      navigator.clipboard.writeText(editor.value);
      showToast('Copied to clipboard!', 'success');
    }

    function downloadConfigJson() {
      // Always use properly formatted JSON with correct key order
      const data = formatConfigJson(config);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'config.json';
      a.click();
      URL.revokeObjectURL(url);
      showToast('Downloaded config.json - save it to /data/config.json', 'success');
    }

    function loadFromConfigJson() {
      // Fetch the current config.json from the site
      fetch('../data/config.json?v=' + Date.now())
        .then(response => {
          if (!response.ok) throw new Error('Could not load config.json');
          return response.json();
        })
        .then(data => {
          config = { ...DEFAULT_CONFIG, ...data };
          saveConfig();
          renderAll();
          updateJsonEditor();
          showToast('Loaded from config.json!', 'success');
        })
        .catch(error => {
          showToast('Could not load config.json: ' + error.message, 'error');
        });
    }

    function handleFileImport(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const parsed = JSON.parse(e.target.result);
          config = { ...DEFAULT_CONFIG, ...parsed };
          saveConfig();
          renderAll();
          updateJsonEditor();
          showToast('Configuration imported from file!', 'success');
        } catch (err) {
          showToast('Invalid JSON file!', 'error');
        }
      };
      reader.readAsText(file);
      // Reset the input so the same file can be selected again
      event.target.value = '';
    }

    function importJson() {
      const editor = document.getElementById('json-editor');
      try {
        const parsed = JSON.parse(editor.value);
        config = { ...DEFAULT_CONFIG, ...parsed };
        saveConfig();
        renderAll();
        showToast('Configuration imported!', 'success');
      } catch (e) {
        showToast('Invalid JSON!', 'error');
      }
    }

    // ==========================================================================
    // UTILITY FUNCTIONS
    // ==========================================================================

    function toggleItem(header) {
      const item = header.closest('.cms-item');
      item.classList.toggle('expanded');
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function truncateUrl(url) {
      if (!url) return 'No URL';
      if (url.length <= 50) return url;
      return url.substring(0, 47) + '...';
    }

    function showToast(message, type = 'info') {
      const existing = document.querySelector('.cms-toast');
      if (existing) existing.remove();

      const toast = document.createElement('div');
      toast.className = `cms-toast cms-toast--${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => toast.remove(), 3000);
    }

    // Initialize
    init();
  </script>
</body>
</html>
